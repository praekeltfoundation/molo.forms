sudo: false
language: python
python:
  - "3.6"
cache:
  directories:
    - $HOME/.pip-cache/

env:
  - TZ=UTC

install:
  - pip install twine
  - pip install --upgrade pip --cache-dir $HOME/.pip-cache/
  - pip install coveralls coverage --cache-dir $HOME/.pip-cache/
  - pip install flake8 --cache-dir $HOME/.pip-cache/
  - pip install -r requirements-dev.txt --cache-dir $HOME/.pip-cache/
  - pip install -e . --cache-dir $HOME/.pip-cache/
script:
  - flake8 molo
  - molo scaffold testapp --require molo.forms --include molo.forms ^forms/
  - cp local_test_settings.py testapp/testapp/settings/local.py
  - mkdir testapp/testapp/templates/
  - mkdir testapp/testapp/templates/core
  - cp molo/forms/test_templates/*.html testapp/testapp/templates/core/
  - cp molo/forms/test_templates/base.html testapp/testapp/templates/base.html
  - flake8 testapp
  - pip install -e testapp
  - py.test --cov=molo.forms --cov-report=term

after_success:
  - coveralls

deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: Praekelt
  password:
    secure: "i5s3WPZ2QUbqVgz0HltK0xMR3k9t5Up+9ow/fxNocG5BAmZksL/jxtrNBIn4puYKx8m222nZ8V4lbHSPg3X9fZqXKDjZepnKAJEdxesyaKI/T2ayz6Y0AUPI1k9r+2tq6NHVrNpQZS3rYWPVeEF4cmmyh33FWxDXsiSYCZK2NgiLiN9Ukw9WR1Ctm1Gyvx/3ASsRlb6H38024nUO7Sc6xebS8qKUxJXmH4duO0TBW5FczbiWF5+gs9kveoVmXj5OCIxhu+LHzq7b5bdDK2gH6kb7vEvfRsrF3tbNCILMeP6RcNNsSJZq2wnZInpp1fpKq3Za6IIrYGoTr4tBd/Yq9ojRmbwYgKK2cC/EYcXJq2qFqDG9Qk4Chw1DtNPRZAwZepOEju/fnXlZHzb+mke5wxESao/iM0kuMjQKDUhkP/3n/6uTEFJQcSgRVUUr8DcRGy0NSo6ZcdgQvFwQswHfiH4x8DiJ6SgEwxBDVDUREm5Ne4+NjJfV7Vwx2hlRzHUrlevgb7BOhcNstuuEpHCLrcWn0MJEnCdEkkr0bMmkxF7EYlWqbMIcHtc9EqvODH1fPQIy47ICtK2gWdCUMZRflgm6sCrWbyww0iWG2m/08rQn2lIo3SYBpUOqwxjKS/7oLY/3pUYro9Ct/8LnZHRETdIk8JLxoGP7IbHoKigZats="
  on:
    tags: true
    python: 3.6
